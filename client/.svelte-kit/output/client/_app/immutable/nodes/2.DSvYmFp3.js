import{a as E,t as F,c as we,d as ge}from"../chunks/disclose-version.BMO508ZJ.js";import{h as x,N as L,V as me,O as Te,b as be,D as xe,T as oe,a7 as ke,a8 as j,M as V,c as O,a5 as fe,a as le,a6 as Ee,aq as z,G as B,ar as Ae,as as Ne,at as Ce,m as Se,$ as Q,au as Pe,av as Ie,S as Fe,aw as Me,d as Oe,I as Re,P as Ue,K as qe,a4 as Z,ax as De,E as Be,ay as He,az as Le,a9 as Ve,u as ze,aA as Ge,z as Ke,n as R,aB as Ye,A as $,B as ee,F as Je,p as ue,j as We,v as J,e as ce,g as w,w as D,x as I,ap as H,s as N,f as ve,y as G,q as ae}from"../chunks/runtime.BQEIYVZe.js";import{a as Xe,e as U,d as je,s as Qe}from"../chunks/render.peUuYpeR.js";import{b as Ze,i as W,p as P,o as $e}from"../chunks/index-client.BbKE-Vs4.js";let K=null;function de(t,e){return e}function ea(t,e,a,r){for(var n=[],o=e.length,i=0;i<o;i++)Ie(e[i].e,n,!0);var _=o>0&&n.length===0&&a!==null;if(_){var p=a.parentNode;Fe(p),p.append(a),r.clear(),k(t,e[0].prev,e[o-1].next)}Me(n,()=>{for(var s=0;s<o;s++){var c=e[s];_||(r.delete(c.k),k(t,c.prev,c.next)),Oe(c.e,!_)}})}function _e(t,e,a,r,n,o=null){var i=t,_={flags:e,items:new Map,first:null};{var p=t;i=x?L(Re(p)):p.appendChild(me())}x&&Te();var s=null,c=!1;be(()=>{var l=a(),f=xe(l)?l:l==null?[]:oe(l),d=f.length;if(c&&d===0)return;c=d===0;let u=!1;if(x){var h=i.data===ke;h!==(d===0)&&(i=j(),L(i),V(!1),u=!0)}if(x){for(var v=null,g,m=0;m<d;m++){if(O.nodeType===8&&O.data===Ue){i=O,u=!0,V(!1);break}var T=f[m],y=r(T,m);g=pe(O,_,v,null,T,y,m,n,e),_.items.set(y,g),v=g}d>0&&L(j())}x||aa(f,_,i,n,e,r),o!==null&&(d===0?s?fe(s):s=le(()=>o(i)):s!==null&&Ee(s,()=>{s=null})),u&&V(!0),a()}),x&&(i=O)}function aa(t,e,a,r,n,o){var i=t.length,_=e.items,p=e.first,s=p,c,l=null,f=[],d=[],u,h,v,g;for(g=0;g<i;g+=1){if(u=t[g],h=o(u,g),v=_.get(h),v===void 0){var m=s?s.e.nodes_start:a;l=pe(m,e,l,l===null?e.first:l.next,u,h,g,r,n),_.set(h,l),f=[],d=[],s=l.next;continue}if(ta(v,u,g),v.e.f&z&&fe(v.e),v!==s){if(c!==void 0&&c.has(v)){if(f.length<d.length){var T=d[0],y;l=T.prev;var b=f[0],C=f[f.length-1];for(y=0;y<f.length;y+=1)te(f[y],T,a);for(y=0;y<d.length;y+=1)c.delete(d[y]);k(e,b.prev,C.next),k(e,l,b),k(e,C,T),s=T,l=C,g-=1,f=[],d=[]}else c.delete(v),te(v,s,a),k(e,v.prev,v.next),k(e,v,l===null?e.first:l.next),k(e,l,v),l=v;continue}for(f=[],d=[];s!==null&&s.k!==h;)s.e.f&z||(c??(c=new Set)).add(s),d.push(s),s=s.next;if(s===null)continue;v=s}f.push(v),l=v,s=v.next}if(s!==null||c!==void 0){for(var M=c===void 0?[]:oe(c);s!==null;)s.e.f&z||M.push(s),s=s.next;var S=M.length;if(S>0){var ye=i===0?a:null;ea(e,M,ye,_)}}B.first=e.first&&e.first.e,B.last=l&&l.e}function ta(t,e,a,r){Ae(t.v,e),t.i=a}function pe(t,e,a,r,n,o,i,_,p){var s=K;try{var c=(p&Ne)!==0,l=(p&Ce)===0,f=c?l?Se(n):Q(n):n,d=p&Pe?Q(i):i,u={i:d,v:f,k:o,a:null,e:null,prev:a,next:r};return K=u,u.e=le(()=>_(t,f,d),x),u.e.prev=a&&a.e,u.e.next=r&&r.e,a===null?e.first=u:(a.next=u,a.e.next=u.e),r!==null&&(r.prev=u,r.e.prev=u.e),u}finally{K=s}}function te(t,e,a){for(var r=t.next?t.next.e.nodes_start:a,n=e?e.e.nodes_start:a,o=t.e.nodes_start;o!==r;){var i=qe(o);n.before(o),o=i}}function k(t,e,a){e===null?t.first=a:(e.next=a,e.e.next=a&&a.e),a!==null&&(a.prev=e,a.e.prev=e&&e.e)}function re(t,e,a,r){var n=t.__attributes??(t.__attributes={});if(x){n[e]=t.getAttribute(e);return}n[e]!==(n[e]=a)&&(a==null?t.removeAttribute(e):typeof a!="string"&&ra(t).includes(e)?t[e]=a:t.setAttribute(e,a))}var se=new Map;function ra(t){var e=se.get(t.nodeName);if(e)return e;se.set(t.nodeName,e=[]);for(var a,r=Z(t),n=Element.prototype;n!==r;){a=De(r);for(var o in a)a[o].set&&e.push(o);r=Z(r)}return e}const sa=requestAnimationFrame,ia=()=>performance.now(),A={tick:t=>sa(t),now:()=>ia(),tasks:new Set};function he(t){A.tasks.forEach(e=>{e.c(t)||(A.tasks.delete(e),e.f())}),A.tasks.size!==0&&A.tick(he)}function na(t){let e;return A.tasks.size===0&&A.tick(he),{promise:new Promise(a=>{A.tasks.add(e={c:t,f:a})}),abort(){A.tasks.delete(e)}}}function q(t,e){t.dispatchEvent(new CustomEvent(e))}function oa(t){if(t==="float")return"cssFloat";if(t==="offset")return"cssOffset";if(t.startsWith("--"))return t;const e=t.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(a=>a[0].toUpperCase()+a.slice(1)).join("")}function ie(t){const e={},a=t.split(";");for(const r of a){const[n,o]=r.split(":");if(!n||o===void 0)break;const i=oa(n.trim());e[i]=o.trim()}return e}const fa=t=>t;function Y(t,e,a,r){var n=(t&Ye)!==0,o="both",i,_=e.inert,p,s;function c(){var h=Je,v=B;$(null),ee(null);try{return i??(i=a()(e,(r==null?void 0:r())??{},{direction:o}))}finally{$(h),ee(v)}}var l={is_global:n,in(){e.inert=_,q(e,"introstart"),p=X(e,c(),s,1,()=>{q(e,"introend"),p==null||p.abort(),p=i=void 0})},out(h){e.inert=!0,q(e,"outrostart"),s=X(e,c(),p,0,()=>{q(e,"outroend"),h==null||h()})},stop:()=>{p==null||p.abort(),s==null||s.abort()}},f=B;if((f.transitions??(f.transitions=[])).push(l),Xe){var d=n;if(!d){for(var u=f.parent;u&&u.f&Be;)for(;(u=u.parent)&&!(u.f&He););d=!u||(u.f&Le)!==0}d&&Ve(()=>{ze(()=>l.in())})}}function X(t,e,a,r,n){var o=r===1;if(Ge(e)){var i,_=!1;return Ke(()=>{if(!_){var v=e({direction:o?"in":"out"});i=X(t,v,a,r,n)}}),{abort:()=>{_=!0,i==null||i.abort()},deactivate:()=>i.deactivate(),reset:()=>i.reset(),t:()=>i.t()}}if(a==null||a.deactivate(),!(e!=null&&e.duration))return n(),{abort:R,deactivate:R,reset:R,t:()=>r};const{delay:p=0,css:s,tick:c,easing:l=fa}=e;var f=[];if(o&&a===void 0&&(c&&c(0,1),s)){var d=ie(s(0,1));f.push(d,d)}var u=()=>1-r,h=t.animate(f,{duration:p});return h.onfinish=()=>{var v=(a==null?void 0:a.t())??1-r;a==null||a.abort();var g=r-v,m=e.duration*Math.abs(g),T=[];if(m>0){if(s)for(var y=Math.ceil(m/16.666666666666668),b=0;b<=y;b+=1){var C=v+g*l(b/y),M=s(C,1-C);T.push(ie(M))}u=()=>{var S=h.currentTime;return v+g*l(S/m)},c&&na(()=>{if(h.playState!=="running")return!1;var S=u();return c(S,1-S),!0})}h=t.animate(T,{duration:m,fill:"forwards"}),h.onfinish=()=>{u=()=>r,c==null||c(r,1-r),n()}},{abort:()=>{h&&(h.cancel(),h.effect=null,h.onfinish=R)},deactivate:()=>{n=R},reset:()=>{r===0&&(c==null||c(1,0))},t:()=>u()}}var la=F('<track kind="captions">'),ua=F('<div class="video-wrapper svelte-5bo78g"><video crossorigin="anonymous" controls class="svelte-5bo78g"></video></div>');function ca(t,e){ue(e,!0);let a=H(void 0);We(()=>{const _=w(a).currentTime-e.time;(_>2||_<-2)&&console.log("if it works"),w(a).currentTime=e.time,e.isPause?w(a).pause():w(a).play()});async function r(_,p){await e.updateTime(_),await e.updatePause(p)}let n=H(!1);var o=ua(),i=D(o);Ze(i,_=>N(a,_),()=>w(a)),_e(i,21,()=>e.captions,de,(_,p)=>{var s=we(),c=ve(s);W(c,()=>w(p)!=="",l=>{var f=la();J(()=>re(f,"src",w(p))),E(l,f)}),E(_,s)}),I(i),I(o),J(()=>re(i,"src",e.videoUrl)),U("play",i,async()=>r(w(a).currentTime,!1)),U("pause",i,async()=>r(w(a).currentTime,!0)),U("timeupdate",i,()=>w(n)&&e.isPause?e.updateTime(w(a).currentTime):null),U("seeking",i,()=>N(n,!0)),U("seeked",i,()=>N(n,!1)),E(t,o),ce()}const va=t=>t;function da(t){const e=t-1;return e*e*e+1}function ne(t,{delay:e=0,duration:a=400,easing:r=va}={}){const n=+getComputedStyle(t).opacity;return{delay:e,duration:a,easing:r,css:o=>`opacity: ${o*n}`}}function _a(t,{delay:e=0,duration:a=400,easing:r=da,start:n=0,opacity:o=0}={}){const i=getComputedStyle(t),_=+i.opacity,p=i.transform==="none"?"":i.transform,s=1-n,c=_*(1-o);return{delay:e,duration:a,easing:r,css:(l,f)=>`
			transform: ${p} scale(${1-s*f});
			opacity: ${_-c*f}
		`}}var pa=(t,e,a)=>e("set?video="+w(a)),ha=F('<button class="chapter svelte-1xbwlx8"> </button>'),ya=(t,e)=>e("end"),wa=F('<div class="player-wrapper svelte-1xbwlx8"><!> <div class="chapters svelte-1xbwlx8"></div></div> <button class="main svelte-1xbwlx8">End the session</button>',1),ga=(t,e)=>e("start"),ma=F('<button class="main svelte-1xbwlx8">Start the session</button>'),Ta=F('<div class="root svelte-1xbwlx8"><h1>Video Player Server</h1> <!></div>');function Aa(t,e){ue(e,!0);let a="/api/",r=H(P({state:"idle",video:null,time:0,isPaused:!1})),n=H(P({}));async function o(l,f="GET",d=null){let u=await fetch(a+l,{method:f,headers:d?{Accept:"application/json","Content-Type":"application/json"}:{},body:d?JSON.stringify(d):null});const h=u.headers.get("content-type");let v;return h==="text/plain;charset=UTF-8"?v=u.text:h==="application/json"?v=await u.json():v="",{status:u.status,data:v}}async function i(){try{let{status:l,data:f}=await o("updates","POST",w(r));if(l===200){let d=f;N(n,P((await o("videos")).data)),N(r,P(d.state))}}catch(l){console.log(l),await new Promise(f=>{setTimeout(()=>f(null),5e3)})}await i()}async function _(){N(r,P((await o("info")).data))}async function p(){N(n,P((await o("videos")).data))}$e(async()=>{await p(),await _(),await i()});var s=Ta(),c=G(D(s),2);W(c,()=>w(r).state==="watch",l=>{var f=wa(),d=ve(f),u=D(d);W(u,()=>w(r).video!==null,g=>{var m=ae(()=>{var y;return a+"med?file="+((y=w(n)[w(r).video].find(b=>b.type==="video"))==null?void 0:y.src)}),T=ae(()=>w(n)[w(r).video].map(y=>y.type==="captions"?a+"med?file="+y.src:""));ca(g,{get time(){return w(r).time},get isPause(){return w(r).isPaused},updatePause:async y=>await o("player?pause="+y),updateTime:async y=>await o("player?time="+y),get videoUrl(){return w(m)},get captions(){return w(T)}})},g=>{var m=ge("No video?");E(g,m)});var h=G(u,2);_e(h,21,()=>Object.keys(w(n)),de,(g,m)=>{var T=ha();T.__click=[pa,o,m];var y=D(T,!0);I(T),J(()=>Qe(y,w(m))),E(g,T)}),I(h),I(d);var v=G(d,2);v.__click=[ya,o],Y(3,d,()=>_a),Y(3,v,()=>ne),E(l,f)},l=>{var f=ma();f.__click=[ga,o],Y(3,f,()=>ne),E(l,f)}),I(s),E(t,s),ce()}je(["click"]);export{Aa as component};
